**Getting Started with Google Cloud Architecture Framework**

- These are the best practices and implementation recommendations to help you design your Google Cloud deployment
- First Step: Focus on designing robust, secure and scalable systems
- 4 Principles:
  - Operational excellence
  - Security, Privacy, and Compliance
  - Reliability
  - Performance and Cost Optimization


*Principle 1: Operational Excellance*

- "Efficiently running, managing and monitoring systems that deliver business value"
- Strategies:
  - Automate build, test and deploy
  - Monitor business objectives metrics
  - Conduct disaster recovery testing
- *Best Practices*
  - Increase software development and release velocity
    - Release Engineering
      - Frequent Small releases
    - Automation
      - Static code analysis and security scans
      - Automate Testing (Unit, Integration, System, Load, Security Testing etc ...)
      - Automate build and release pipeline
        - A/B or Canary testing
    - Services:
      - Cloud Source Repositories: Fully Featured, private Git repository
        - Similar to Github
      - Container Registry: Store your docker images
      - Cloud Build: Build deployable artifacts (jars or docker images) from your source code and configuration
  - Monitor System health and business health
    - Understand four golden signals
      - Latency - How fast are you responding to your users?
      - Traffic - How does the load on your system look?
      - Errors - Are any request failing?
      - Saturation - What's the utilization levels of your resources?
    - Logging: Use cloud logging and export to Cloud Storage, BigQuery and Pub/Sub depending on your needs.
    - Metrics: Define and capture metrics SLIs, SLOs etc
    - Monitoring: Cloud Monitoring can aggregate metrics, logs and events
      - Define alerts and custom metrics to identify problems and resolve them quickly
      - You can create visual dashboards as well
      - Generate actionable alerts
    - Key Services:
      - Cloud Monitoring, Cloud Logging, Cloud Debugger, Error Reporting, Cloud Trace and Cloud Profiler.
    - Design for Disaster Recovery:
      - Create well-defined disaster recovery (DR) plan
        - Define recovery time objective (RTO) and recovery point objective (RPO)
        - Consider everything in your DR plan: Applications (compute etc), Data (databases etc), Network Infrastructure, Bandwidth, Facilities
        - Use features provided by Google Cloud:
          - Use Global network to build redundancy
          - Managed services make Scalability easy
      - Regularly test your DR plan
      - Example features you can make use of:
        - Schedule Persistent Disk snapshots for your VMs and copy them across regions
        - Enable live migration to keep your VMs running even when there is software or hardware maintenance
        - Use cloud DNS to switch from primary to backup

*Principle 2: Security, Privacy and Compliance*

- Plan your security controls, privacy and meet your compliance needs
- Strategies
  - Implement least privilege with identity and authorization controls
  - Build a layered security approach
  - Automate deployment of sensitive tasks
  - Implement Security Monitoring
- Manage Authentication and Authorization
  - Follow Identityv and Access Management (IAM) Best Practices
    - Grant appropriate roles
    - Understand when to use service accounts
      - Treat each app component as a seperate trust boundary
        - Create separate service account for each component/service with the minimum permissions needed
    - Use organizational policy service (what is allowed in your organization?)
    - Use cloud asset Inventory (Track your inventory)
    - Use cloud audit logs to audit IAM policy changes and service accounts
- Implememt Compute Security Controls
  - Use private IPs as much as possible
  - Create Hardened VM Images (OS + Minimum Software)
  - Use shielded VMs to prevent remote attacks, privilege escalation and malicious insiders
- Secure the network:
  - Use a carefully designed custom VPC (DO not use the default VPC)
  - Isolates workloads into individual projects by creating one VPC per project
  - Control ingress and egress network traffic using firewall rules
  - Run advanced security and traffic inspection tools
  - Use security command center to analyze the security of your infrastructure
  - Use Network Intelligence Center to evaluate your network topology and architecture
- Implement Data security controls:
  - (Default) Google cloud encrypts customer data stored at rest
    - Use Customer managed or customer supplied keys based on your neeeds
  - Use Object versioning in Cloud Storage for sensitive data
    - Use object lifecycle management to reduce costs
    - Achieve compliance with retention policies using Bucket Lock
    - Use signed URLs to give time-limited read or write access to an object
  - Implement Data Security
    - Use Cloud data loss prevention (DLP) API to classify, mask, tokenize and transform sensitive data (ensure data privacy for sensitive data elements like credit card numbers, names, SSNs, phone numbers etc)
- Audit your infrastructure with audit logs
  - Use Cloud Audit Logs
    - Export to cloud storage, Bigquery or Pub/Sub based on your needs
  - Enable access transparency logs (trace Google support team actions)

*Principle 3: Reliability*

- Most important feature of any application/service:
  - Keys:
    - Measurable reliability goals
    - Architect for scalability, high availability and automated change management
    - Self Healing and observability are important
    - Quick recovery from failures using automation as much as possible
  - Strategies:
    - Define KPIs, SLOs and SLIs
    - Create redundancy (Prefer horizontal scalability)
    - Make incremental changes
      - Include rollback capability
    - Instrument system for observability
    - Automate detection of failure
    - Document and automate emergency responses
    - Test failure recovery
    - Reduce toil (Eliminate manual work)
- Define reliability goals: Service level objectives & error budgets
  - Clearly define SLIs, SLOs, SLAs and Error Budgets
- Build observability into your infrastructure and applications
  - Monitoring, Logging, Tracing, Profiling, Debugging, etc.
- Design for scale and high availability
  - Design a multi-region architecture with failover
  - Eliminate scalability bottlenecks
    - Prefer horizontal scalability
  - Degrade service levels gracefully
    - Static web pages when dynamic web site is down
    - Temporarily disabling data updates
  - Implement exponential backoff with jitter
    - Exponentially increasing wait time before retry
  - Predict peak traffic events and plan for them
- Build flexible and automated deployment capabilities:
  - Ensure that every change can be rolled back
  - Spread out traffic for timed promotions and launches
  - Implement progressive rollouts with canary testing
- Build efficient alerting
- Build a collaborative process for incident management
  - Reduce mean time to detect (MTTD): Alert teams at the right time
  - Reduce mean time to mitigate (MTTM): Properly documented and well-exercised incident management plan.
  - Increase mean time between failures (MTBF): Build reliable systems
  - Blameless postmortem culture

*Principle 4: Performance & Cost Optimization*

- Strategies:
  - Evaluate performance requirements
  - Use scalable design patterns
  - Identify and implement cost-saving approaches
- Use Autoscaling and Data Processing
  - Autoscale Compute Engine VMs with managed instance groups (MIGs)- Uses an instance template
  - Enable cluster autoscaler and Pod autoscaling (Horizontal Pod Autoscaler) on Google Kubernetes Engine Clusters (GKE).
  - Try serverless options: Cloud Run, App Engine, Cloud Functions, Dataproc and Dataflow
  - Use google cloud load balancers to provide a global endpoint
- Use GPUs and TPUs to increase performance
  - Use GPUs to accelerate machine learning and data processing workloads
  - Use TPUs for massive matrix operations performed in your machine learning workloads
- Identify apps to tune
  - Use Cloud Trace, Cloud Debugger and Cloud Profiler to gain insights into your apps
  - Instrument apps to identify inter-service communication latencies or identify bottlenecks
- Analyze your costs and optimize
  - Export billing to BigQuery to analyze your billing data
    - Use Google Data Studio to visualize
  - Understand sustained use discounts
  - Make use of Committed use discounts for predictable long term workloads
  - Use preemptible VMs for non critical fault tolerant workloads
  - Use Cloud Storage Object Lifecycle Management to reduce storage costs