**Google Cloud IAM**

- IAM is a global service.
- You have a whole umbrella of project, in which there are multiple resources. These resources are needed to be managed and accessed by certain number of resources. These contributors or identities that need to access these resources can be humans(like a user assigned to do certain work on some part of resources) or machines(like a service account that needs to access some resources to perform some task or an application which needs to talk to the database).
- In GCP, Identity and access management (Cloud IAM) provides this service of Identifying and configuring access and actions to those resources.
- Cloud Identity and Access Management looks for Authentication(Is it the right user?) and Authorization(Do they have the access rights to perform the action?).
- Identities can be
  - A GCP User (Google Account or Externally Aythenticated User)
  - A Group of GCP Users
  - An application running in GCP
  - An application running in your datacenter
- Provides very fine grained access or granular control.
  - Limit a single user:
    - To perform a single action
    - On a specific cloud resource
    - From a specific IP address
    - During a specific time period
- In Cloud IAM
  - ROLES: A set of permissions (to perform specific actions on a specific resource)
    - Roles do not know about members. They are just a set of permissions.
  - POLICY: You assign (or bind) to role to a member which you can assign the permissions.
  - Here you can choose a role with the right permissions and assign it to the right member. Example: Storage Object Admin
  - Now you can create the Policy binding member (your friend) with the needed roles and permissions.

**IAM Roles**

- Roles are permissions:
  - Perform some set of actions on some set of resources.
- Three Types:
  - Basic Roles (or primitive roles): Owner/Editor/Viewer
    - Viewer(roles/viewer): Read-only actions
    - Editor(roles/editor): Viewer + Edit actions
    - Owner(roles/owner): Editor + Manage roles and permissions + Billing
    - These roles are not recommended to be used in production.
  - Predefined Roles: Fine grained roles pre-defined and are managed by Google.
    - Different roles for different purposes.
    - Examples: Storage Admin, Storage Object Admin, Storage Object Viewer, Storage Object Creator.
  - Custom Roles: You can create your own roles. When predefined roles are not sufficient, you can create your own custom roles.
- Go to Roles by searching into the search bar.
- You can filter and search for roles.
- Creating a custom role:
  - Give your role a title.
  - Give an ID, choose the right ID as you need to bind it to a member.
  - You can choose between the role launch stage which can be Alpha/Beta/General Availability/Disabled.
  - Now you can add permissions to your role, like a specific permission to create a specific resource.
  - Now click create to make your custom role.

  - Important cloud storage roles:
    - Storage Admin (roles/storage.admin):
      - storage.buckets.*
      - storage.objects.*
    - Storage Object Admin (roles/storage.objectAdmin):
      - storage.objects.*
    - Storage Object Creator (roles/storage.objectCreator):
      - storage.object.create
    - Storage Object Viewer (roles/storage.objectViewer):
      - storage.objects.get
      - storage.objects.list
  - All four roles have these permissions:
    - resourcemanager.projects.get
    - resourcemanager.projects.list

**IAM-Most Important Concepts**

- Member: Who is the user or service account that is being assigned a role.
- Role: What permissions are being assigned to the member.
- Policy: Assign permissions to members.
  - Map roles(what?), Members(who?) and Conditions (Which Resources, where?).
  - Permissions are not directly assigned to member.
    - Permissions are represented by roles.
    - Member gets permissions through roles.
  - A role can have multiple permissions.
  - You can assign multiple roles to a member.

- IAM POLICY: Roles are assigned to users through IAM policy documents.
- Represented by a policy object
  - Policy object has a list of bindings.
  - A binding, binds a role to the list of members.
- A member type is represted by its prefix.
  - Example: user, serviceaccount, group or domain.

IAM Policy- Example:

{

    "bindings": [
        
        {
            
            "role": "roles/storage.objectAdmin",
            
            "members": [
                
                "user:abhinav@cloud-devops-enthusiast",
                
                "serviceAccount:myAppName@appspot.gserviceaccount.com",
                
                "group:administrators@cloud-devops-enthusiast.com",
                
                "domain:google.com"
        
        },
        
        {
            
            "role": "roles/storage.objectViewer",
            
            "members": [
            
                "user:abhinav@cloud-devops-enthusiast",
            
            ]
            
            condition": {
            
                    "title": "Limited time access",
            
                    "description": "Only upto Feb 2022",
            
                    "expression": "request.time < timestamp('2022-02-01T00:00:00.00Z')",
            
                }
            
            ]
        
        }
    
    ]

}

*Commands:*

- gcloud compute project-info describe
- gcloud auth list
- gcloud projects get-iam-policy glowing-furnance-304608
- gcloud projects add-iam-policy-binding glowing-furnance-304608 --member=user:in28min@gmail.com --role=roles/storage.objectAdmin
- gcloud projects remove-iam-policy-binding glowing-furnance-304608 --member=user:in28min@gmail.com --role=roles/storage.objectAdmin
- gcloud iam roles describe roles/storage.objectAdmin
- gcloud iam roles copy --source=roles/storage.objectAdmin --destination=my.custom.role --dest-project=glowing-furnance-304608

- Member is also called as PRINCIPAL or identity.
- You can assign roles by adding them in iam and assigning the role and if needed you can even configure the conditions.
- You can use the Policy Troubleshooter role to find issue with anybodys access. If someone is unable to access anything. You can do this by choosing the project and choosing the permission for which you want to check. You can add more and check access for those accounts.


**SERVICE ACCOUNTS**

- A service account represents a google cloud service identify, such as code running on Compute Engine VM's, App Engine, or Cloud Functions running outside Google.
- Organizational policies can be used secure service accounts and blocks risky service account features, such as automatic IAM grants, key creation/upload or the creation of service accounts entirely.
- Scenario: An application on a VM needs access to a cloud resource.
  - You don't want to use personal credentials to allow access.
- (Recommended) Use service accounts
  - Identified by an email address (ex: id-compute@developer.gserviceaccount.com)
  - Does not have a password
    - Has a private/public RSA key-pairs
    - You can't login via browsers or cookies
- Service Account types:
  - Default service account: Automatically created when some services are used.
    - (not recommended) Has editor role by default.
  - User Managed- User Created
    - (recommended) Provides fine grained access control.