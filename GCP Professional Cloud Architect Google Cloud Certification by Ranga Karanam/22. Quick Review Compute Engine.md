**SSHing into Linux VMs**

- Compute Engine Linux VMs uses key-based SSH authentication.
- Two Options:
  - Metadata Managed: Manually create and configure individual SSH keys.
  - OS Login: Manage SSH access without managing individual SSH keys.
    - Recommended for managing multiple users across instances or projects.
    - Your Linux user account is linked to your Google identity.
    - To enable: Set enable-oslogin to true in metadata.
      - gcloud compute project-info/instances add-metadata --metadata enable-oslogin=true
    - (Advantage) Ability to import existing linux accounts from on premises AD and LDAP.
    - Users need to have roles: roles/compute.osLogin or roles/compute.osAdminLogin
- Windows VMs use password-based authentication (username and password).
  - Generate using console or gcloud (gcloud compute reset-windows-password)

- *Option 1: Console- SSH Button*
  - Ephemeral SSH key pair is created by Compute Engine.
- *Option 2: Gcloud- gcloud compute ssh*
  - A username and persistent SSH key pair are created by Compute Engine
  - SSH key pair reused for future interactions
- *Option 3: Use Customized SSH keys*
  - (Metadata managed): Upload the public key to the project metadata.
  - (OS Login): Upload your public SSH key to your OS Login profile.
    - gcloud compute os-login ssh-keys add OR
    - Use OS Login API: POST https://oslogin.googleapis.com/v1/users/ACCOUNT_EMAIL:importSshPublicKey
- You can disable project wide SSH keys on a specific compute instance.

**Executing Shutdown Scripts on a GCE VM**

- For example, you're using a preemtible VM and want to save data before the VM is terminated.
- Startup Script is something that you can choose to specify a script that will run when your instances boots up or restarts. Startup scripts can be used to install software, configure the instance, or perform other initialization tasks and to ensure that services are running within the instance.
- Execute commands before a GCE VM is stopped, terminated or restarted.
  - Perform cleanup or export of logs.
  - Application for preemptible VMs and Non preemptible VMs.
- Very similar to startup scripts.
  - Run as:
    - Root user for Linux VMs
    - System account in Windows VMs
  - Stored as metadata
    - --metadata-from-file shutdown-script=script.sh
    - You can store startup and shutdown scripts in cloud storage.
      - --metadata shutdown-script-url=gs://bucket-in-cloud-storage/file-name
- Run on best-effort basis
  - Example: Won't run if you use hard reset (instances.reset)